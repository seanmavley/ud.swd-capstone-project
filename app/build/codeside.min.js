angular.module("codeSide",["ui.router","firebase","ui.codemirror"]).config(["$stateProvider","$urlRouterProvider",function(e,o){e.state("home",{url:"/",templateUrl:"home/home.html",controller:"HomeController"}).state("emailVerify",{url:"/verify-email?mode&oobCode",templateUrl:"auth/verify-email.html",controller:"emailVerifyController",resolve:{currentAuth:["Auth",function(e){return e.$requireSignIn()}]}}).state("about",{url:"/about",templateUrl:"templates/about.html"}).state("new",{url:"/new",templateUrl:"codes/new.html",controller:"CreateController",resolve:{currentAuth:["Auth",function(e){return e.$requireSignIn()}]}}).state("detail",{url:"/codes/:codeId",templateUrl:"codes/detail.html",controller:"DetailController"}).state("detailFromTo",{url:"/:title/:from/to/:to",templateUrl:"codes/detailfromto.html"}).state("signup",{url:"/register",templateUrl:"auth/register.html",controller:"LogRegController"}).state("login",{url:"/login",templateUrl:"auth/login.html",controller:"LogRegController",params:{message:null}}).state("admin",{url:"/admin",templateUrl:"admin/admin.html",controller:"AdminController",resolve:{currentAuth:["Auth",function(e){return e.$requireSignIn()}]}}),o.otherwise("/")}]).run(["$rootScope","$state","Auth",function(e,o,t){e.$on("$stateChangeError",function(e,t,a,r,n,i){"AUTH_REQUIRED"===i&&o.go("login")})}]),angular.module("codeSide").controller("AdminController",["$scope","$firebaseObject","$firebaseArray","currentAuth","Auth","DatabaseRef",function(e,o,t,a,r,n){e.newPassword="",e.formData={};var i=o(n.child("users").child(a.uid));i.$loaded().then(function(){i.emailVerified||toastr.error("You have not verified your email","Verify Email",{timeOut:0}),e.authInfo=i,e.formData=i,e.hideUsername=!0,e.formData.username||(e.hideUsername=!1,toastr.error("Please set your username. Once set, cannot be changed.","Username required!",{timeOut:0}))});var s=n.child("codes").orderByChild("uid").equalTo(a.uid),l=t(s);l.$loaded().then(function(o){e.list=o})["catch"](function(e){toastr.error(e.message)}),e.sendVerifyEmail=function(){toastr.info("Sending email verification message to your email. Check inbox now!","Email Verification"),a.sendEmailVerification()},e.updateUser=function(){e.formData.displayName?(console.log(e.formData),i.$loaded().then(function(){n.child("users").child(a.uid).update({username:e.formData.username,displayName:e.formData.displayName})}),e.hideUsername=!0,toastr.clear(),toastr.info("User updated")):toastr.error("Please add full name")},e.updatePassword=function(){r.$updatePassword(e.newPassword).then(function(){toastr.success("Password updated successfully","Successful!"),e.newPassword=""})["catch"](function(e){toastr.error(e.message,e.reason)})},e.loadLanguages=function(){n.child("languages").update({php:"PHP",python:"Python",csharp:"C#",cpp:"C++",javascript:"Javascript",java:"Java"},function(e){toastr.error(e.message,e.reason)})}}]),angular.module("codeSide").controller("LogRegController",["$scope","Auth","$state","DatabaseRef","$firebaseObject",function(e,o,t,a,r){e.formData={},e.login=function(){e.formData.email||e.formData.password?o.$signInWithEmailAndPassword(e.formData.email,e.formData.password).then(function(e){e.emailVerified||(e.sendEmailVerification(),toastr.info("Email verification sent","Verify email!")),t.go("home")})["catch"](function(o){toastr.error(o.message,o.reason,{timeOut:1e4}),e.formData={}}):toastr.error("Add email and password")},e.register=function(){e.formData.email&&e.formData.password&&e.formData.username?(console.log(e.formData.email,e.formData.password),o.$createUserWithEmailAndPassword(e.formData.email,e.formData.password).then(function(o){var r=!1;"seanmavley@gmail.com"==e.formData.email&&(r=!0),a.child("users").child(o.uid).set({username:e.formData.username,displayName:o.displayName||"",email:o.email,emailVerified:o.emailVerified,admin:r}),o.sendEmailVerification(),toastr.success("Awesome! Welcome aboard. Login to begin coding!","Register Successful",{timeOut:7e3}),t.go("admin")})["catch"](function(o){toastr.error(o.message,o.reason),e.formData={}})):toastr.error("Kindly complete the form","Some parts missing!")},e.googleAuth=function(){var e=new firebase.auth.GoogleAuthProvider;e.addScope("https://www.googleapis.com/auth/plus.login"),o.$signInWithPopup(e).then(function(e){var o=!1;"seanmavley@gmail.com"==e.user.email&&(o=!0),console.log(e.user);var n=r(a.child("users").child(e.user.uid));n.$loaded().then(function(t){n.$save({displayName:t.displayName||e.user.displayName,email:t.email||e.user.email,emailVerified:t.emailVerified||e.user.emailVerified,admin:t.admin||o,createdAt:(new Date).getTime()})}),toastr.success("Logged in with Google successfully","Success"),t.go("admin")})["catch"](function(e){toastr.error(e.message,e.reason)})},e.facebookAuth=function(){var e=new firebase.auth.FacebookAuthProvider;e.addScope("email"),o.$signInWithPopup(e).then(function(e){toastr.success("Logged in with Google successfully","Success"),t.go("home")})["catch"](function(e){toastr.error(e.message,e.reason)})}}]).controller("emailVerifyController",["$scope","$stateParams","Auth","currentAuth",function(e,o,t,a){firebase.auth().applyActionCode(o.oobCode).then(function(e){DatabaseRef.child("users").child(a.uid).update({emailVerified:!0})})["catch"](function(o){e.error=o.message,toastr.error(o.message,o.reason,{timeOut:0})})}]),angular.module("codeSide").factory("Auth",["$firebaseAuth",function(e){return e()}]),angular.module("codeSide").controller("MenuController",["$scope","Auth","$state",function(e,o,t){o.$onAuthStateChanged(function(o){null!=o?e.loggedIn=!0:e.loggedIn=!1}),e.logout=function(){o.$signOut(),o.$onAuthStateChanged(function(e){console.log("loggedout")}),t.go("login")}}]),angular.module("codeSide").controller("CreateController",["$scope","$state","$firebaseObject","$firebaseArray","DatabaseRef","Auth",function(e,o,t,a,r,n){e.editor1Options={lineWrapping:!0,lineNumbers:!0,readOnly:!1},e.editor2Options={lineWrapping:!0,lineNumbers:!0,readOnly:!1};var i=n.$getAuth(),s=a(r.child("codes")),l=t(r.child("users").child(i.uid));l.$loaded().then(function(o){e.profile=o,console.log(e.profile)}),e.notReady=!0;var c=t(r.child("languages"));c.$loaded().then(function(o){toastr.success("All is set. Code away!","Document ready!"),e.languages=o,console.log(o),e.notReady=!1},function(e){toastr.error(e.message,"Oh no, error!")}),e.code1Change=function(o){e.codeDuplicate=!1,e.formData.to==e.formData.from?(toastr.warning("You cannot select same progamming language on both sides","Fix it!",{tapToDismiss:!1,timeOut:0}),e.codeDuplicate=!0):(toastr.clear(),e.codeDuplicate=!1,console.log("code changed to: "+o),["csharp","cpp"].includes(o)?(console.log("I am one of clike: "+o),e.editor1Options.mode=o,console.log(e.editor1Options.mode)):(e.editor1Options.mode=e.formData.from,console.log(e.editor1Options.mode)))},e.code2Change=function(o){e.codeDuplicate=!1,e.formData.to==e.formData.from?(toastr.warning("You cannot select same progamming language on both sides","Fix it!",{tapToDismiss:!1,timeOut:0}),e.codeDuplicate=!0):(toastr.clear(),e.codeDuplicate=!1,console.log("code changed to: "+o),["csharp","cpp"].includes(o)?(console.log("I am one of clike: "+o),e.editor2Options.mode=o,console.log(e.editor2Options.mode)):(e.editor2Options.mode=e.formData.to,console.log(e.editor2Options.mode)))},e.sending=!1,e.addNew=function(){e.addForm.$invalid?toastr.error("Please fill the form, all of it!","Throw in the best of your coding spices.","It means a lot!","Incomplete form"):e.formData.from==e.formData.to?toastr.warning("You cannot select same progamming languages on both sides","Fix it!"):(toastr.info("data.sending($scope.data, callback(detailPage, { param: $scope.data.id }));","Saved Successfully"),e.sending=!0,s.$loaded().then(function(){console.log(e.formData);var t=(new Date).getTime();s.$add({title:e.formData.title,uid:i.uid,createdBy:e.profile.username,createdAt:t,description:e.formData.description}).then(function(a){r.child("codes").child(a.key).child("snippets").child(e.formData.from).set({name:e.formData.from,code:e.formData.fromCode,createdAt:t,uid:i.uid,createdBy:e.profile.username}),r.child("codes").child(a.key).child("snippets").child(e.formData.to).set({name:e.formData.to,code:e.formData.toCode,uid:i.uid,createdAt:t,createdBy:e.profile.username}),console.log("Hands are clean now"),o.go("detail",{codeId:a.key})})["catch"](function(e){console.log(e),toastr.error(e.message,"Error")})}))}}]),angular.module("codeSide").controller("DetailController",["$scope","$state","$stateParams","DatabaseRef","$firebaseObject","$firebaseArray","Auth",function(e,o,t,a,r,n,i){function s(o){console.log(o);var a={name:o.name,code:o.code,createdAt:(new Date).getTime(),createdBy:e.profile.username};console.log(a);var r=c.child("codes").child(t.codeId).child("snippets").child(o.name).update(a);return console.log("Thanks for saving this: ",r),toastr.success("Changes saved!"),r}function l(e){var o=d.child("snippets").child(e);return r(o)}e.editorOptions={lineWrapping:!0,lineNumbers:!0,readOnly:"nocursor"},e.loading=!0,e.editAllowed=!0,e.enableEditing=function(){e.editorOptions.readOnly=!1,e.editAllowed=!e.editAllowed};var c=a,d=c.child("codes").child(t.codeId),u=r(d),m=n(d.child("snippets")),f=c.child("languages"),g=r(f),h=i.$getAuth();if(h){var p=r(a.child("users").child(h.uid));p.$loaded().then(function(o){e.profile=o,console.log(e.profile)})}e.saveLanguage=function(o){e.profile?s(o):toastr.error("You are not logged in","Log in first!")},g.$loaded().then(function(o){e.languages=o,console.log(o)}),u.$loaded().then(function(){e.loading=!1,e.formData={createdBy:u.createdBy,title:u.title,createdAt:u.createdAt,snippets:u.snippets,description:u.description},m.$loaded().then(function(o){e.codeOne=l(o.$keyAt(0)),e.codeTwo=l(o.$keyAt(1))})}),e.codeOneChanged=function(o){u.$loaded().then(function(){toastr.success("Running to fetch the code"),e.refreshOne=!0;var t=l(o);t.$loaded().then(function(){t.code?(console.log("something came out"),e.codeOne=t):(console.log("nothing came out"),e.codeOne={name:o,code:""})}),console.log(e.codeOne),e.refreshOne=!1})},e.codeTwoChanged=function(o){u.$loaded().then(function(){toastr.success("Running to fetch the code"),e.refreshTwo=!0;var t=l(o);t.$loaded().then(function(){t.code?(console.log("something came out"),e.codeTwo=t):(console.log("nothing came out"),e.codeTwo={name:o,code:""})}),console.log(e.codeTwo),e.refreshOne=!1})}}]),angular.module("codeSide").controller("HomeController",["$scope","$rootScope","Auth","DatabaseRef","$firebaseArray",function(e,o,t,a,r){var n=a,i=n.child("codes"),s=i.orderByChild("createdAt").limitToLast(10),l=r(s);l.$loaded().then(function(o){e.list=o})["catch"](function(e){toastr.error(e.message)})}]),angular.module("codeSide").factory("DatabaseRef",function(){return firebase.database().ref()}),$(document).foundation(),toastr.options={closeButton:!1,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-top-right",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};