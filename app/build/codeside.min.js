angular.module("codeSide",["ui.router","firebase","ui.codemirror","ngProgress","ui.router.title"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,o){e.state("home",{url:"/",templateUrl:"home/home.html",controller:"HomeController",meta:{title:"Homepage",description:"Your Favorite Programming Languages, Side By Side"}}).state("emailVerify",{url:"/verify-email?mode&oobCode",templateUrl:"auth/verify-email.html",controller:"emailVerifyController",resolve:{currentAuth:["Auth",function(e){return e.$requireSignIn()}]},meta:{title:"Verify Email",description:"Email Verification"}}).state("about",{url:"/about",templateUrl:"templates/about.html",meta:{title:"About",description:"CodeBySide, a simple and fast way to compare code, side by side. Find out what CodeBySide is all about"}}).state("tos",{url:"/tos-privacy",templateUrl:"templates/privacy-terms.html",meta:{title:"ToS and Privacy Policy"}}).state("new",{url:"/new",templateUrl:"codes/new.html",controller:"CreateController",resolve:{currentAuth:["Auth",function(e){return e.$requireSignIn()}]},meta:{title:"Create new"}}).state("detail",{url:"/codes/:codeId",templateUrl:"codes/detail.html",controller:"DetailController",meta:{title:"Code Detail",description:"Code Description"}}).state("detailFromTo",{url:"/:title/:from/to/:to",templateUrl:"codes/detailfromto.html"}).state("signup",{url:"/register",templateUrl:"auth/register.html",controller:"LogRegController",meta:{title:"Sign up"}}).state("login",{url:"/login",templateUrl:"auth/login.html",controller:"LogRegController",params:{message:null,toWhere:null},meta:{title:"Login"}}).state("admin",{url:"/admin",templateUrl:"admin/admin.html",controller:"AdminController",resolve:{currentAuth:["Auth",function(e){return e.$requireSignIn()}]},meta:{title:"Admin",restricted:!0}}),t.otherwise("/"),o.html5Mode(!0)}]).run(["$rootScope","$state","$location","Auth","ngProgressFactory",function(e,t,o,a,r){var n=r.createInstance();e.$on("$stateChangeError",function(e,o,a,r,i,s){"AUTH_REQUIRED"===s&&(t.go("login",{toWhere:o}),n.complete())}),e.$on("$stateChangeStart",function(e,t,o,a,r){n.start()}),e.$on("$stateChangeSuccess",function(){e.title=t.current.meta.title,e.description=t.current.meta.description,n.complete()})}]),angular.module("codeSide").controller("AdminController",["$scope","$firebaseObject","$firebaseArray","currentAuth","Auth","DatabaseRef",function(e,t,o,a,r,n){e.newPassword="",e.formData={};var i=t(n.child("users").child(a.uid));i.$loaded().then(function(){a.emailVerified||(e.notVerified=!0,toastr.clear(),toastr.error("You have not verified your email","Verify Email",{timeOut:0})),e.authInfo=i,e.formData=i,e.hideUsername=!0,e.formData.username||(e.hideUsername=!1,toastr.error("Please set your username. Once set, cannot be changed.","Username required!",{timeOut:0}))});var s=n.child("codes").orderByChild("uid").equalTo(a.uid),l=o(s);l.$loaded().then(function(t){e.list=t})["catch"](function(e){toastr.error(e.message)}),e.sendVerifyEmail=function(){toastr.info("Sending email verification message to your email. Check inbox now!","Email Verification"),a.sendEmailVerification()},e.updateUser=function(){e.formData.displayName?(console.log(e.formData),i.$loaded().then(function(){n.child("users").child(a.uid).update({username:e.formData.username,displayName:e.formData.displayName},function(t){t?(toastr.clear(),toastr.error("You cannot edit your username. Username is set once","Not allowed",{timeOut:0})):(e.hideUsername=!0,toastr.clear(),toastr.info("User updated"))})})):toastr.error("Please add full name")},e.updatePassword=function(){r.$updatePassword(e.newPassword).then(function(){toastr.success("Password updated successfully","Successful!"),e.newPassword=""})["catch"](function(e){toastr.error(e.message,e.reason)})},e.loadLanguages=function(){n.child("languages").update({php:"PHP",python:"Python",csharp:"C#",cpp:"C++",javascript:"Javascript",java:"Java"},function(e){toastr.error(e.message,e.reason)})}}]),angular.module("codeSide").controller("LogRegController",["$scope","$stateParams","Auth","$state","$rootScope","DatabaseRef","$firebaseObject",function(e,t,o,a,r,n,i){e.formData={},e.login=function(){e.formData.email||e.formData.password?o.$signInWithEmailAndPassword(e.formData.email,e.formData.password).then(function(e){null!==t.toWhere?(console.log(t.toWhere),a.go(t.toWhere.name),t.toWhere=null,console.log(t.toWhere)):a.go("admin"),e.emailVerified||(toastr.info("Your email is NOT verified.","Verify email!"),a.go("admin"))})["catch"](function(t){toastr.error(t.message,t.reason,{timeOut:1e4}),e.formData={}}):toastr.error("Add email and password")},e.register=function(){e.formData.email&&e.formData.password&&e.formData.username?(console.log(e.formData.email,e.formData.password),o.$createUserWithEmailAndPassword(e.formData.email,e.formData.password).then(function(t){var o=!1;"seanmavley@gmail.com"==e.formData.email&&(o=!0),n.child("users").child(t.uid).set({username:e.formData.username,displayName:t.displayName||"",email:t.email,admin:o}),toastr.info("Sending email verification link. Check email!","You've got mail!"),t.sendEmailVerification(),toastr.success("Awesome! Welcome aboard. Login to begin coding!","Register Successful",{timeOut:7e3}),a.go("admin")})["catch"](function(t){toastr.error(t.message,t.reason),e.formData={}})):toastr.error("Kindly complete the form","Some parts missing!")},e.googleAuth=function(){var e=new firebase.auth.GoogleAuthProvider;e.addScope("https://www.googleapis.com/auth/plus.login"),o.$signInWithPopup(e).then(function(e){var t=!1;"seanmavley@gmail.com"==e.user.email&&(t=!0),console.log(e.user);var o=i(n.child("users").child(e.user.uid));o.$loaded().then(function(a){o.$save({displayName:a.displayName||e.user.displayName,email:a.email||e.user.email,admin:a.admin||t,createdAt:(new Date).getTime()})}),toastr.success("Logged in with Google successfully","Success"),a.go("admin")})["catch"](function(e){toastr.error(e.message,e.reason)})},e.facebookAuth=function(){var e=new firebase.auth.FacebookAuthProvider;e.addScope("email"),o.$signInWithPopup(e).then(function(e){toastr.success("Logged in with Google successfully","Success"),a.go("home")})["catch"](function(e){toastr.error(e.message,e.reason)})}}]),angular.module("codeSide").factory("Auth",["$firebaseAuth",function(e){return e()}]),angular.module("codeSide").controller("emailVerifyController",["$scope","$stateParams","currentAuth","DatabaseRef",function(e,t,o,a){console.log(o),e.doVerify=function(){firebase.auth().applyActionCode(t.oobCode).then(function(e){toastr.success("Verification happened","Success!")})["catch"](function(t){e.error=t.message,toastr.error(t.message,t.reason,{timeOut:0})})}}]),angular.module("codeSide").controller("MenuController",["$scope","Auth","$state",function(e,t,o){t.$onAuthStateChanged(function(t){null!=t?e.loggedIn=!0:e.loggedIn=!1}),e.logout=function(){t.$signOut(),t.$onAuthStateChanged(function(e){console.log("loggedout")}),o.go("login")}}]),angular.module("codeSide").controller("CreateController",["$scope","$state","$firebaseObject","$firebaseArray","DatabaseRef","Auth","currentAuth",function(e,t,o,a,r,n,i){e.editorOneOptions={lineWrapping:!0,lineNumbers:!0,readOnly:!1},e.editorTwoOptions={lineWrapping:!0,lineNumbers:!0,readOnly:!1},e.emailVerified=i.emailVerified,e.sending=!1,e.notReady=!0;var s=a(r.child("codes")),l=o(r.child("users").child(i.uid));l.$loaded().then(function(t){e.profile=t});var c=o(r.child("languages"));c.$loaded().then(function(t){e.languages=t,e.notReady=!1,i.emailVerified&&toastr.success("All is set. Code away!","Document ready!")},function(e){toastr.error(e.message,"Couldnt not load languages")}),e.code1Change=function(t){e.codeDuplicate=!1,e.formData.to==e.formData.from?(toastr.warning("You cannot select same progamming language on both sides","Fix it!",{tapToDismiss:!1,timeOut:0}),e.codeDuplicate=!0):(toastr.clear(),e.codeDuplicate=!1,console.log("code changed to: "+t),["csharp","cpp"].includes(t)?(console.log("I am one of clike: "+t),e.editorOneOptions.mode=t):e.editorOneOptions.mode=e.formData.from)},e.code2Change=function(t){e.codeDuplicate=!1,e.formData.to==e.formData.from?(toastr.warning("You cannot select same progamming language on both sides","Fix it!",{tapToDismiss:!1,timeOut:0}),e.codeDuplicate=!0):(toastr.clear(),e.codeDuplicate=!1,console.log("code changed to: "+t),["csharp","cpp"].includes(t)?(console.log("I am one of clike: "+t),e.editorTwoOptions.mode=t):e.editorTwoOptions.mode=e.formData.to)},e.addNew=function(){e.addForm.$invalid?toastr.error("Please fill the form, all of it!","Throw in the best of your coding spices.","It means a lot!","Incomplete form"):e.formData.from==e.formData.to?toastr.warning("You cannot select same progamming languages on both sides","Fix it!"):e.profile.username?(toastr.info("data.sending($scope.data, callback(detailPage, { param: $scope.data.id }));","Saved Successfully"),e.sending=!0,s.$loaded().then(function(){console.log(e.formData);var o=(new Date).getTime();s.$add({title:e.formData.title,uid:i.uid,createdBy:e.profile.username,createdAt:o,description:e.formData.description}).then(function(a){r.child("snippets").child(a.key).child(e.formData.from).set({name:e.formData.from,code:e.formData.fromCode,createdAt:o,uid:i.uid,createdBy:e.profile.username}),r.child("snippets").child(a.key).child(e.formData.to).set({name:e.formData.to,code:e.formData.toCode,uid:i.uid,createdAt:o,createdBy:e.profile.username}),console.log("Hands are clean now"),t.go("detail",{codeId:a.key})})["catch"](function(e){console.log(e),toastr.error(e.message,"Error")})})):toastr.warning('Kindly visit the <a ui-sref="admin" style="text-decoration:underline;">Admin Page</a>to add username first. Thank you!',"Your Username is Missing!")}}]),angular.module("codeSide").controller("DetailController",["$scope","$rootScope","$state","$stateParams","DatabaseRef","$firebaseObject","$firebaseArray","Auth",function(e,t,o,a,r,n,i,s){function l(t){if(null==t.createdBy){var o={name:t.name,code:t.code,createdAt:(new Date).getTime(),createdBy:e.profile.username};console.log(o);var r=u.child("snippets").child(a.codeId).child(t.name).update(o);return console.log("Saving Done!"),toastr.success("Changes saved!"),r}if(e.profile.username==t.createdBy){var o={name:t.name,code:t.code};console.log(o);var r=u.child("snippets").child(a.codeId).child(t.name).update(o);return console.log("Saving Done!"),toastr.success("Changes saved!"),r}toastr.error("Because you did not create this snippet, you cannot edit","Not allowed")}function c(e){return n(f.child(e))}e.editorOneOptions={lineWrapping:!0,lineNumbers:!0,readOnly:"nocursor"},e.editorTwoOptions={lineWrapping:!0,lineNumbers:!0,readOnly:"nocursor"};var d=(new Date).getTime();e.loading=!0,e.editAllowed=!0,e.enableEditing=function(){e.editorOneOptions.readOnly=!1,e.editorTwoOptions.readOnly=!1,e.editAllowed=!e.editAllowed};var u=r,m=u.child("codes").child(a.codeId),f=u.child("snippets").child(a.codeId),g=u.child("languages"),h=u.child("users"),p=n(m),y=i(f),$=n(g);s.$waitForSignIn().then(function(t){var o=t;if(o){var s=n(h.child(o.uid));s.$loaded().then(function(t){e.profile=t})}else console.log("You are not logged in!");var l=r.child("revision").child(a.codeId),c=i(l);c.$loaded().then(function(t){e.revisionTwo=t})}),e.saveLanguage=function(t){e.profile?l(t):toastr.error("You are not logged in","Log in first!")},$.$loaded().then(function(t){e.languages=t}),p.$loaded().then(function(o){e.loading=!1,console.log(o.title),t.title=o.title,e.formData={createdBy:o.createdBy,title:o.title,createdAt:o.createdAt,description:o.description,codeId:o.$id,uid:o.uid},y.$loaded().then(function(t){e.formData.snippets=t,e.codeOne=c(t.$keyAt(0)),e.codeTwo=c(t.$keyAt(1))})}),e.codeOneChanged=function(t){p.$loaded().then(function(){e.refreshOne=!0;var o=c(t);o.$loaded().then(function(){o.code?(console.log("something came out"),e.codeOne=o,toastr.clear()):(toastr.clear(),console.log("nothing came out"),toastr.info('This code snippet has not been created. Start typing, then click "Save"',"Create snippet!",{timeOut:0}),e.codeOne={name:t,code:""})}),e.refreshOne=!1})},e.codeTwoChanged=function(t){p.$loaded().then(function(){e.refreshTwo=!0;var o=c(t);o.$loaded().then(function(){o.code?(console.log("something came out"),e.codeTwo=o,toastr.clear()):(toastr.clear(),console.log("nothing came out"),toastr.info('This code snippet has not been created. Start typing, then click "Save"',"Create snippet!",{timeOut:0}),e.codeTwo={name:t,code:""})}),e.refreshOne=!1})},e.updateCode=function(){var t={title:e.formData.title,description:e.formData.description,updatedAt:d};u.child("codes").child(a.codeId).update(t,function(e){e?toastr.error(e.message,e.reason):toastr.success("Updated succefully")})}}]),angular.module("codeSide").controller("HomeController",["$scope","$rootScope","Auth","DatabaseRef","$firebaseArray",function(e,t,o,a,r){var n=a,i=n.child("codes"),s=i.orderByChild("createdAt").limitToLast(50),l=r(s);l.$loaded().then(function(t){e.list=t})["catch"](function(e){toastr.error(e.message)})}]),angular.module("codeSide").factory("DatabaseRef",function(){return firebase.database().ref()}),function(e,t,o,a,r,n,i){e.GoogleAnalyticsObject=r,e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r].l=1*new Date,n=t.createElement(o),i=t.getElementsByTagName(o)[0],n.async=1,n.src=a,i.parentNode.insertBefore(n,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-59418377-1","auto"),ga("send","pageview"),$(document).foundation(),toastr.options={closeButton:!1,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-top-right",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};