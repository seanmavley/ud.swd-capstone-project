angular.module("codeSide",["ui.router","firebase","ui.codemirror","ngProgress","ui.router.title"]).config(["$stateProvider","$urlRouterProvider",function(e,o){e.state("home",{url:"/",templateUrl:"home/home.html",controller:"HomeController",data:{title:"Homepage"}}).state("emailVerify",{url:"/verify-email?mode&oobCode",templateUrl:"auth/verify-email.html",controller:"emailVerifyController",resolve:{currentAuth:["Auth",function(e){return e.$requireSignIn()}],$title:function(){return"Verify Email"}}}).state("about",{url:"/about",templateUrl:"templates/about.html",data:{title:"About"}}).state("tos",{url:"/tos-privacy",templateUrl:"templates/privacy-terms.html",data:{title:"ToS and Privacy Policy"}}).state("new",{url:"/new",templateUrl:"codes/new.html",controller:"CreateController",resolve:{currentAuth:["Auth",function(e){return e.$requireSignIn()}]},data:{title:"Create new"}}).state("detail",{url:"/codes/:codeId",templateUrl:"codes/detail.html",controller:"DetailController",data:{title:"Code Detail"}}).state("detailFromTo",{url:"/:title/:from/to/:to",templateUrl:"codes/detailfromto.html"}).state("signup",{url:"/register",templateUrl:"auth/register.html",controller:"LogRegController",data:{title:"Sign up"}}).state("login",{url:"/login",templateUrl:"auth/login.html",controller:"LogRegController",params:{message:null,toWhere:null},data:{title:"Login"}}).state("admin",{url:"/admin",templateUrl:"admin/admin.html",controller:"AdminController",resolve:{currentAuth:["Auth",function(e){return e.$requireSignIn()}]},data:{title:"Admin",restricted:!0}}),o.otherwise("/")}]).run(["$rootScope","$state","$location","Auth","ngProgressFactory",function(e,o,t,a,r){var n=r.createInstance();e.$on("$stateChangeError",function(e,t,a,r,i,s){"AUTH_REQUIRED"===s&&(o.go("login",{toWhere:t}),n.complete())}),e.$on("$stateChangeStart",function(e,o,t,a,r){n.start()}),e.$on("$stateChangeSuccess",function(){e.title=o.current.data.title,n.complete()})}]),angular.module("codeSide").controller("AdminController",["$scope","$firebaseObject","$firebaseArray","currentAuth","Auth","DatabaseRef",function(e,o,t,a,r,n){e.newPassword="",e.formData={};var i=o(n.child("users").child(a.uid));i.$loaded().then(function(){a.emailVerified||(e.notVerified=!0,toastr.clear(),toastr.error("You have not verified your email","Verify Email",{timeOut:0})),e.authInfo=i,e.formData=i,e.hideUsername=!0,e.formData.username||(e.hideUsername=!1,toastr.error("Please set your username. Once set, cannot be changed.","Username required!",{timeOut:0}))});var s=n.child("codes").orderByChild("uid").equalTo(a.uid),l=t(s);l.$loaded().then(function(o){e.list=o})["catch"](function(e){toastr.error(e.message)}),e.sendVerifyEmail=function(){toastr.info("Sending email verification message to your email. Check inbox now!","Email Verification"),a.sendEmailVerification()},e.updateUser=function(){e.formData.displayName?(console.log(e.formData),i.$loaded().then(function(){n.child("users").child(a.uid).update({username:e.formData.username,displayName:e.formData.displayName},function(o){o?(toastr.clear(),toastr.error("You cannot edit your username. Username is set once","Not allowed",{timeOut:0})):(e.hideUsername=!0,toastr.clear(),toastr.info("User updated"))})})):toastr.error("Please add full name")},e.updatePassword=function(){r.$updatePassword(e.newPassword).then(function(){toastr.success("Password updated successfully","Successful!"),e.newPassword=""})["catch"](function(e){toastr.error(e.message,e.reason)})},e.loadLanguages=function(){n.child("languages").update({php:"PHP",python:"Python",csharp:"C#",cpp:"C++",javascript:"Javascript",java:"Java"},function(e){toastr.error(e.message,e.reason)})}}]),angular.module("codeSide").controller("LogRegController",["$scope","$stateParams","Auth","$state","$rootScope","DatabaseRef","$firebaseObject",function(e,o,t,a,r,n,i){e.formData={},e.login=function(){e.formData.email||e.formData.password?t.$signInWithEmailAndPassword(e.formData.email,e.formData.password).then(function(e){null!=o.toWhere&&a.go(o.toWhere.name),e.emailVerified||(toastr.info("Your email is NOT verified.","Verify email!"),a.go("admin"))})["catch"](function(o){toastr.error(o.message,o.reason,{timeOut:1e4}),e.formData={}}):toastr.error("Add email and password")},e.register=function(){e.formData.email&&e.formData.password&&e.formData.username?(console.log(e.formData.email,e.formData.password),t.$createUserWithEmailAndPassword(e.formData.email,e.formData.password).then(function(o){var t=!1;"seanmavley@gmail.com"==e.formData.email&&(t=!0),n.child("users").child(o.uid).set({username:e.formData.username,displayName:o.displayName||"",email:o.email,admin:t}),toastr.info("Sending email verification link. Check email!","You've got mail!"),o.sendEmailVerification(),toastr.success("Awesome! Welcome aboard. Login to begin coding!","Register Successful",{timeOut:7e3}),a.go("admin")})["catch"](function(o){toastr.error(o.message,o.reason),e.formData={}})):toastr.error("Kindly complete the form","Some parts missing!")},e.googleAuth=function(){var e=new firebase.auth.GoogleAuthProvider;e.addScope("https://www.googleapis.com/auth/plus.login"),t.$signInWithPopup(e).then(function(e){var o=!1;"seanmavley@gmail.com"==e.user.email&&(o=!0),console.log(e.user);var t=i(n.child("users").child(e.user.uid));t.$loaded().then(function(a){t.$save({displayName:a.displayName||e.user.displayName,email:a.email||e.user.email,admin:a.admin||o,createdAt:(new Date).getTime()})}),toastr.success("Logged in with Google successfully","Success"),a.go("admin")})["catch"](function(e){toastr.error(e.message,e.reason)})},e.facebookAuth=function(){var e=new firebase.auth.FacebookAuthProvider;e.addScope("email"),t.$signInWithPopup(e).then(function(e){toastr.success("Logged in with Google successfully","Success"),a.go("home")})["catch"](function(e){toastr.error(e.message,e.reason)})}}]),angular.module("codeSide").factory("Auth",["$firebaseAuth",function(e){return e()}]),angular.module("codeSide").controller("emailVerifyController",["$scope","$stateParams","currentAuth","DatabaseRef",function(e,o,t,a){console.log(t),e.doVerify=function(){firebase.auth().applyActionCode(o.oobCode).then(function(e){toastr.success("Verification happened","Success!")})["catch"](function(o){e.error=o.message,toastr.error(o.message,o.reason,{timeOut:0})})}}]),angular.module("codeSide").controller("MenuController",["$scope","Auth","$state",function(e,o,t){o.$onAuthStateChanged(function(o){null!=o?e.loggedIn=!0:e.loggedIn=!1}),e.logout=function(){o.$signOut(),o.$onAuthStateChanged(function(e){console.log("loggedout")}),t.go("login")}}]),angular.module("codeSide").controller("CreateController",["$scope","$state","$firebaseObject","$firebaseArray","DatabaseRef","Auth","currentAuth",function(e,o,t,a,r,n,i){e.editorOneOptions={lineWrapping:!0,lineNumbers:!0,readOnly:!1},e.editorTwoOptions={lineWrapping:!0,lineNumbers:!0,readOnly:!1},e.emailVerified=i.emailVerified,e.sending=!1,e.notReady=!0;var s=a(r.child("codes")),l=t(r.child("users").child(i.uid));l.$loaded().then(function(o){e.profile=o});var d=t(r.child("languages"));d.$loaded().then(function(o){e.languages=o,e.notReady=!1,i.emailVerified&&toastr.success("All is set. Code away!","Document ready!")},function(e){toastr.error(e.message,"Couldnt not load languages")}),e.code1Change=function(o){e.codeDuplicate=!1,e.formData.to==e.formData.from?(toastr.warning("You cannot select same progamming language on both sides","Fix it!",{tapToDismiss:!1,timeOut:0}),e.codeDuplicate=!0):(toastr.clear(),e.codeDuplicate=!1,console.log("code changed to: "+o),["csharp","cpp"].includes(o)?(console.log("I am one of clike: "+o),e.editorOneOptions.mode=o):e.editorOneOptions.mode=e.formData.from)},e.code2Change=function(o){e.codeDuplicate=!1,e.formData.to==e.formData.from?(toastr.warning("You cannot select same progamming language on both sides","Fix it!",{tapToDismiss:!1,timeOut:0}),e.codeDuplicate=!0):(toastr.clear(),e.codeDuplicate=!1,console.log("code changed to: "+o),["csharp","cpp"].includes(o)?(console.log("I am one of clike: "+o),e.editorTwoOptions.mode=o):e.editorTwoOptions.mode=e.formData.to)},e.addNew=function(){e.addForm.$invalid?toastr.error("Please fill the form, all of it!","Throw in the best of your coding spices.","It means a lot!","Incomplete form"):e.formData.from==e.formData.to?toastr.warning("You cannot select same progamming languages on both sides","Fix it!"):e.profile.username?(toastr.info("data.sending($scope.data, callback(detailPage, { param: $scope.data.id }));","Saved Successfully"),e.sending=!0,s.$loaded().then(function(){console.log(e.formData);var t=(new Date).getTime();s.$add({title:e.formData.title,uid:i.uid,createdBy:e.profile.username,createdAt:t,description:e.formData.description}).then(function(a){r.child("snippets").child(a.key).child(e.formData.from).set({name:e.formData.from,code:e.formData.fromCode,createdAt:t,uid:i.uid,createdBy:e.profile.username}),r.child("snippets").child(a.key).child(e.formData.to).set({name:e.formData.to,code:e.formData.toCode,uid:i.uid,createdAt:t,createdBy:e.profile.username}),console.log("Hands are clean now"),o.go("detail",{codeId:a.key})})["catch"](function(e){console.log(e),toastr.error(e.message,"Error")})})):toastr.warning('Kindly visit the <a ui-sref="admin" style="text-decoration:underline;">Admin Page</a>to add username first. Thank you!',"Your Username is Missing!")}}]),angular.module("codeSide").controller("DetailController",["$scope","$rootScope","$state","$stateParams","DatabaseRef","$firebaseObject","$firebaseArray","Auth",function(e,o,t,a,r,n,i,s){function l(o){if(null==o.createdBy){var t={name:o.name,code:o.code,createdAt:(new Date).getTime(),createdBy:e.profile.username};console.log(t);var r=u.child("snippets").child(a.codeId).child(o.name).update(t);return console.log("Saving Done!"),toastr.success("Changes saved!"),r}if(e.profile.username==o.createdBy){var t={name:o.name,code:o.code};console.log(t);var r=u.child("snippets").child(a.codeId).child(o.name).update(t);return console.log("Saving Done!"),toastr.success("Changes saved!"),r}toastr.error("Because you did not create this snippet, you cannot edit","Not allowed")}function d(e){return n(f.child(e))}e.editorOneOptions={lineWrapping:!0,lineNumbers:!0,readOnly:"nocursor"},e.editorTwoOptions={lineWrapping:!0,lineNumbers:!0,readOnly:"nocursor"},e.revisionsShow={lineWrapping:!0,lineNumbers:!0,readOnly:"nocursor"},e.revisionsAdd={lineWrapping:!0,lineNumbers:!0,readOnly:!1};var c=(new Date).getTime();e.loading=!0,e.editAllowed=!0,e.showRevOne=!1,e.showRevTwo=!1,e.revisionTwo={},e.revisionOne={},e.enableAlternative=function(o){"one"==o&&(e.showRevOne=!e.showRevOne),"two"==o&&(e.showRevTwo=!e.showRevTwo)},e.addAlternative=function(o,t){o.code?(r.child("revision").child(a.codeId).push({codeId:a.codeId,code:o.code,createdBy:e.profile.username,uid:currentAuth.uid,createdAt:c,language:t.name}),toastr.success("Added your code!","Successful")):toastr.error("Kindly add code","Code missing!")},e.enableEditing=function(){e.editorOneOptions.readOnly=!1,e.editorTwoOptions.readOnly=!1,e.editAllowed=!e.editAllowed};var u=r,m=u.child("codes").child(a.codeId),f=u.child("snippets").child(a.codeId),g=u.child("languages"),h=u.child("users"),p=n(m),y=i(f),w=n(g);s.$waitForSignIn().then(function(o){var t=o;if(t){var s=n(h.child(t.uid));s.$loaded().then(function(o){e.profile=o})}else console.log("You are not logged in!");var l=r.child("revision").child(a.codeId),d=i(l);d.$loaded().then(function(o){e.revisionTwo=o})}),e.saveLanguage=function(o){e.profile?l(o):toastr.error("You are not logged in","Log in first!")},w.$loaded().then(function(o){e.languages=o}),p.$loaded().then(function(t){e.loading=!1,o.title=t.title,e.formData={createdBy:t.createdBy,title:t.title,createdAt:t.createdAt,description:t.description,codeId:t.$id,uid:t.uid},y.$loaded().then(function(o){e.formData.snippets=o,e.codeOne=d(o.$keyAt(0)),e.codeTwo=d(o.$keyAt(1))})}),e.codeOneChanged=function(o){p.$loaded().then(function(){e.refreshOne=!0;var t=d(o);t.$loaded().then(function(){t.code?(console.log("something came out"),e.codeOne=t):(console.log("nothing came out"),e.codeOne={name:o,code:""})}),e.refreshOne=!1})},e.codeTwoChanged=function(o){p.$loaded().then(function(){e.refreshTwo=!0;var t=d(o);t.$loaded().then(function(){t.code?(console.log("something came out"),e.codeTwo=t):(console.log("nothing came out"),e.codeTwo={name:o,code:""})}),e.refreshOne=!1})},e.updateCode=function(){var o={title:e.formData.title,description:e.formData.description,updatedAt:c};u.child("codes").child(a.codeId).update(o,function(e){e?toastr.error(e.message,e.reason):toastr.success("Updated succefully")})}}]),angular.module("codeSide").controller("HomeController",["$scope","$rootScope","Auth","DatabaseRef","$firebaseArray",function(e,o,t,a,r){var n=a,i=n.child("codes"),s=i.orderByChild("createdAt").limitToLast(50),l=r(s);l.$loaded().then(function(o){e.list=o})["catch"](function(e){toastr.error(e.message)})}]),angular.module("codeSide").factory("DatabaseRef",function(){return firebase.database().ref()}),function(e,o,t,a,r,n,i){e.GoogleAnalyticsObject=r,e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r].l=1*new Date,n=o.createElement(t),i=o.getElementsByTagName(t)[0],n.async=1,n.src=a,i.parentNode.insertBefore(n,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-59418377-1","auto"),ga("send","pageview"),$(document).foundation(),toastr.options={closeButton:!1,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-top-right",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};